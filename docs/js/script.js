"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}var RatingWidget=function(){function t(e){_classCallCheck(this,t),this.articleId=e.getAttribute("data-article-id"),this.ratingForm=this._createElement("form",{class:"article__rating",action:"/"});var i=this._createElement("input",{type:"hidden",name:"article-id",value:this.articleId});this.ratingForm.appendChild(i),this.hiddenInput=this._createElement("input",{type:"hidden",name:"article-rating"}),this.ratingForm.appendChild(this.hiddenInput);var a=this._createElement("fieldset",{class:"article__rating-fields"}),r=this._createElement("legend",{class:"article__rating-legend"},"Как вам статья?");a.appendChild(r);var n=["Очень понравилось","В целом понравилось","В целом не понравилось","Очень не понравилось"];this.radio=[];for(var s=0;s<n.length;s++){var l=this._createElement("div",{class:"article__rating-radio-wrapper"});this.radio[s]=this._createElement("input",{class:"article__rating-radio",type:"radio",name:"article-rating-radio",value:String(n.length-s),"aria-label":n[s]}),this.radio[s].addEventListener("change",this._handleRadioChange.bind(this,this.radio[s]));var c=this._createElement("div",{class:"article__rating-emoji"});l.appendChild(this.radio[s]),l.appendChild(c),a.appendChild(l)}this.ratingForm.appendChild(a),this.textWrapper=this._createElement("div",{class:"article__rating-text-wrapper"}),this.textArea=this._createElement("textarea",{class:"article__rating-text",name:"article-rating-msg",placeholder:"Посоветуйте, что мы могли бы улучшить"});var h=this._createElement("button",{class:"article__rating-btn"},"Отправить");this.textWrapper.appendChild(this.textArea),this.textWrapper.appendChild(h),this.ratingForm.appendChild(this.textWrapper),document.addEventListener("click",this._handleDocumentClick.bind(this)),this.ratingForm.addEventListener("submit",this._submitForm.bind(this)),window.addEventListener("storage",this._checkSavedState.bind(this)),this._checkSavedState.call(this),e.querySelector(".article__aside").appendChild(this.ratingForm)}return _createClass(t,[{key:"_createElement",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=document.createElement(t);for(var r in e)a.setAttribute(r,e[r]);return i&&(a.innerText=i),a}},{key:"_handleRadioChange",value:function(t){var e=this;if(this.hiddenInput.value=t.value,this._disableForm.call(this),t.value<3){var i=t.getBoundingClientRect();this.textWrapper.style.top=i.top+Math.abs(i.height/2)+window.pageYOffset+"px",this.textWrapper.style.left=i.left+Math.abs(i.width)+window.pageXOffset+"px",this.textWrapper.classList.add("article__rating-text-wrapper--active"),setTimeout((function(){e.textArea.focus()}),300)}else this._submitForm.call(this)}},{key:"_handleDocumentClick",value:function(t){!this.textWrapper.contains(t.target)&&this.textWrapper.classList.contains("article__rating-text-wrapper--active")&&(this.textWrapper.classList.remove("article__rating-text-wrapper--active"),this.textWrapper.removeAttribute("style"),this._submitForm.call(this))}},{key:"_disableForm",value:function(){this.radio.forEach((function(t){t.setAttribute("disabled","")}))}},{key:"_submitForm",value:function(t){t&&t.preventDefault(),this.textWrapper.classList.remove("article__rating-text-wrapper--active"),this.textWrapper.removeAttribute("style");var e=new FormData(this.ratingForm),i={};e.forEach((function(t,e){return i[e]=t.toString()})),localStorage.setItem("rating-for:".concat(this.articleId),i["article-rating"]),console.log(i)}},{key:"_checkSavedState",value:function(){var t=localStorage.getItem("rating-for:".concat(this.articleId));t&&(this.radio[this.radio.length-t].setAttribute("checked",""),this._disableForm.call(this))}}]),t}();document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".article").forEach((function(t){new RatingWidget(t)}))}));